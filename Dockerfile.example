# Dockerfile that attempts to build from a scanner.ll file and a parser.y
#
# Example use:
#
#  docker build --tag flexbison -f Dockerfile.example .
#  docker run --rm -it -V ${PWD}:/ flexbison
#
# and then review the generated files.

FROM ubuntu:latest

# I run a local apt-cacher-ng at http://apt.lan:3142/ so by building with
#  docker build --tag flub --build-arg APT_PROXY=http://apt.lan:3142/,
#  the following makes my docker builds radically faster.
ARG APT_PROXY=""
ENV APT_PROXY=${APT_PROXY}
RUN if [ -n "${APT_PROXY:-}" ]; then \
        echo "Acquire::Http::Proxy { \"${APT_PROXY}\"; };" >/etc/apt/apt.conf.d/02proxy; \
    fi

RUN apt update && \
    apt install -qy flex bison && \
    apt clean && \
    rm -rf /var/lib/apt/lists/*

VOLUME /work
WORKDIR /work

# Run flex and bison to generate files
CMD flex++ scanner.ll && bison -Wcounterexamples -d parser.y && echo "flex/bison files generated. see 'git status' to see which files."
